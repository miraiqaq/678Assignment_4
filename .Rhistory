library(arm)
m1 = glm(fupacts ~ factor(women_alone), family=poisson, data=risky_behaviors)
display(m1)
install.packages("arm")
install.packages("foreign")
knitr::opts_chunk$set(echo = TRUE,out.width="0.9\\linewidth",dev="pdf",fig.align  = 'center')
pacman::p_load("ggplot2","knitr","faraway","arm","hett","data.table","foreign","car","VGAM","MASS")
library(arm)
library(foreign)
m1 = glm(fupacts ~ factor(women_alone), family=poisson, data=risky_behaviors)
display(m1)
m1 = glm(round(fupacts) ~ factor(women_alone), family=poisson, data=risky_behaviors)
display(m1)
m1 = glm(round(fupacts) ~ women_alone), family=poisson, data=risky_behaviors)
m1 = glm(round(fupacts) ~ women_alone, family=poisson, data=risky_behaviors)
display(m1)
knitr::opts_chunk$set(echo = TRUE,out.width="0.9\\linewidth",dev="pdf",fig.align  = 'center')
pacman::p_load("ggplot2","knitr","faraway","arm","hett","data.table","foreign","car","VGAM","MASS")
# library(arm)
# library(foreign)
risky_behaviors<-read.dta("http://www.stat.columbia.edu/~gelman/arm/examples/risky.behavior/risky_behaviors.dta")
m1 = glm(round(fupacts) ~ women_alone, family=poisson, data=risky_behaviors)
display(m1)
m1 = glm(round(fupacts) ~ women_alone + couples, family=poisson, data=risky_behaviors)
display(m1)
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risks)
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risks$fupacts
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
overdispersion = sum(z^2) / (n-k)
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
overdispersion = sum(z^2) / (n-k)
overdispersion
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sd(yhat)
overdispersion = sum(z^2) / (n-k)
overdispersion
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
overdispersion = sum(z^2) / (n-k)
overdispersion
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=risky_behaviors,family = poisson)
display(m2)
m2 = glm(round(fupacts) ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=risky_behaviors,family = poisson)
display(m2)
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
m1 = glm(round(fupacts) ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
overdispersion = sum(z^2) / (n-k)
overdispersion
View(risky_behaviors)
m2 = glm(log(fupacts) ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=risky_behaviors,family = poisson)
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=risky_behaviors,family = poisson)
display(m2)
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=risky_behaviors, offset = log(bupacts), family = poisson)
sub = risks[risky_behaviors$bupacts > 0,]
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=risky_behaviors, offset = log(bupacts), family = poisson)
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
View(sub)
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
m3 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = quasipoisson)
display(m3)
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
well = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
well$log.arsenic = log(well$arsenic)
summary(well)
View(well)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
probit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="probit"), data=wells)
display(probit)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
probit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="probit"), data=wells)
display(probit)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
probit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="probit"), data=wells)
display(probit)
predict_data = c(1,3.21,321.15,1,0,1.3452)
predict(logit,predict_data)
predict_data = data.frame(1,3.21,321.15,1,0,1.3452)
predict(logit,predict_data)
View(predict_data)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log(wells$arsenic) + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
probit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="probit"), data=wells)
display(probit)
predict_data = data.frame(1,3.21,321.15,1,0,1.3452)
predict(logit,predict_data)
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
View(risky_behaviors)
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
print(is.factor(women_alone))
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
predict_data = data.frame(wt=(1,3.21,321.15,1,0,1.3452))
predict_data = data.frame(wt=c(1,3.21,321.15,1,0,1.3452))
predict(logit,predict_data)
predict_data = data.frame(wt=c(3.21,321.15,1,0,1.3452))
predict(logit,predict_data)
View(wells)
arsenic = 3.21
dist = 321.15
assoc = 1
educ = 7
predict_data = data.frame(wt=c(3.21,321.15,1,0))
predict(logit,predict_data)
arsenic = 3.21
dist = 321.15
assoc = 1
educ = 7
predict_data = data.frame(wt=c(3.21,321.15,1,7))
predict(logit,predict_data)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log(arsenic) + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
probit = glm(switch ~ log.arsenic + dist + educ, family=binomial(link="probit"), data=wells)
display(probit)
arsenic = 3.21
dist = 321.15
educ = 7
predict_data = data.frame(arsenic,dsist,educ)
arsenic = 3.21
dist = 321.15
educ = 7
predict_data = data.frame(arsenic,dist,educ)
predict(logit,predict_data)
wells = read.table("http://www.stat.columbia.edu/~gelman/arm/examples/arsenic/wells.dat")
wells$log.arsenic = log(wells$arsenic)
#summary(wells)
logit = glm(switch ~ log(arsenic) + dist + educ, family=binomial(link="logit"), data=wells)
display(logit)
probit = glm(switch ~ log(arsenic) + dist + educ, family=binomial(link="probit"), data=wells)
display(probit)
arsenic = 3.21
dist = 321.15
educ = 7
predict_data = data.frame(arsenic,dist,educ)
predict(logit,predict_data)
predict(probit,predict_data)
lalonde<-read.dta("http://www.stat.columbia.edu/~gelman/arm/examples/lalonde/NSW.dw.obs.dta")
pacman::p_load(ggplot2, knitr, arm, data.table,Cairo)
knitr::opts_chunk$set(echo = TRUE,dev="CairoPNG",fig.align = "center",
fig.width = 5.656, fig.height = 4, global.par = TRUE)
par (mar=c(3,3,2,1), mgp=c(2,.7,0), tck=-.01)
predict_data = pyth[41:60,2:3]
pyth.data=pyth[1:40,]
gelman_example_dir<-"http://www.stat.columbia.edu/~gelman/arm/examples/"
pyth <- read.table (paste0(gelman_example_dir,"pyth/exercise2.1.dat"),
header=T, sep=" ")
pyth.data=pyth[1:40,]
pyth.lm = lm(y~x1+x2, data=pyth.data)
summary(pyth.lm)
# library(ggplot2)
# ggplot(pyth.data) + aes(x=x1+x2,y) + geom_point() + stat_smooth(method="lm",col="red",se=FALSE)
car::marginalModelPlots(pyth.lm)
# pyth.res = resid(pyth.lm)
# plot(pyth.data$x1+pyth.data$x2, pyth.res, ylab="residuals", xlab="x1+x2", main="Residual Plot")
# abline(0,0)
plot(pyth.lm,which=1,add.smooth=FALSE)
predict_data = pyth[41:60,2:3]
predict(pyth.lm,predict_data)
arsenic = runif(10,0.51,9.65)
dist = runif(10,0.387,339.53)
educ = sample(0:17,10,replace = T)
predict_data = data.frame(arsenic,dist,educ)
predict(logit,predict_data)
predict(probit,predict_data)
lalonde<-read.dta("http://www.stat.columbia.edu/~gelman/arm/examples/lalonde/NSW.dw.obs.dta")
View(lalonde)
install.packages("packagename")
knitr::opts_chunk$set(echo = TRUE,out.width="0.9\\linewidth",dev="pdf",fig.align  = 'center')
pacman::p_load("ggplot2","knitr","faraway","arm","hett","data.table","foreign","car","VGAM","MASS")
summary(lalonde)
summary(lalonde)
View(risky_behaviors)
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
z
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
z
head(z)
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sd(yhat)
head(z)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
head(z)
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sd(yhat)
z2 =  (y - yhat) / sqrt(yhat)
head(z)
head(z2)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sd(yhat)
z2 =  (y - yhat) / sqrt(mean(yhat))
head(z)
head(z2)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
# head(z)
# z2 =  (y - yhat) / sd(yhat)
# head(z2)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
summary(lalonde)
m1 = tobit(re78 ~ educ + factor(treat) + factor(black) + factor(married))
？tobit
?tobit()
summary(lalonde)
tobit = vglm(re78 ~ educ + factor(treat) + factor(black) + factor(married), tobit(Upper = 121174), data = lalonde)
#m1 = tobit(re78 ~ educ + factor(treat) + factor(black) + factor(married))
#summary(lalonde)
tobit = vglm(re78 ~ educ + factor(treat) + factor(black) + factor(married), tobit(Upper = 121174), data = lalonde)
summary(tobit)
#m1 = tobit(re78 ~ educ + factor(treat) + factor(black) + factor(married))
#summary(lalonde)
tobit = vglm(re78 ~ educ + factor(treat) + factor(black) + factor(married) + age, tobit(Upper = 121174), data = lalonde)
summary(tobit)
#m1 = tobit(re78 ~ educ + factor(treat) + factor(black) + factor(married))
#summary(lalonde)
lalonde$re78 = (lalonde$re78 - mean(lalonde$re78)) / sd(lalonde$re78)
tobit = vglm(re78 ~ educ + factor(treat) + factor(black) + factor(married) + age, tobit(Upper = 121174), data = lalonde)
summary(tobit)
#m1 = tobit(re78 ~ educ + factor(treat) + factor(black) + factor(married))
View(lalonde)
#summary(lalonde)
lalonde$re78 = (lalonde$re78 - mean(lalonde$re78)) / sd(lalonde$re78)
tobit = vglm(re78 ~ educ + factor(treat) + factor(black) + factor(married) + age, tobit(Upper = 121174), data = lalonde)
summary(tobit)
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
congress<-read.csv("congress.csv",header=TRUE)
View(congress)
#sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
knitr::opts_chunk$set(echo = TRUE,out.width="0.9\\linewidth",dev="pdf",fig.align  = 'center')
pacman::p_load("ggplot2","knitr","faraway","arm","hett","data.table","foreign","car","VGAM","MASS")
risky_behaviors<-read.dta("http://www.stat.columbia.edu/~gelman/arm/examples/risky.behavior/risky_behaviors.dta")
risky_behaviors$fupacts = round(risky_behaviors$fupacts)
#print(is.factor(risky_behaviors$women_alone))
m1 = glm(fupacts ~ factor(women_alone) + factor(couples), family=poisson, data=risky_behaviors)
display(m1)
n = nrow(risky_behaviors)
k = length(m1$coef)
y = risky_behaviors$fupacts
yhat = predict(m1, type = "response")
z =  (y - yhat) / sqrt(yhat)
# head(z)
# z2 =  (y - yhat) / sd(yhat)
# head(z2)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
#sub = risky_behaviors[risky_behaviors$bupacts > 0,]
m2 = glm(fupacts ~ factor(women_alone) + factor(couples) + factor(bs_hiv) + factor(sex), data=sub, offset = log(bupacts), family = poisson)
display(m2)
n = nrow(sub)
k = length(m2$coef)
y = sub$fupacts
yhat = predict(m2, type = "response")
z =  (y - yhat) / sqrt(yhat)
cat("The overdispersion ratio is ", sum(z^2)/(n-k), "\n")
cat("And the p-value of the overdispersion test is", 1 - pchisq( sum(z^2), n - k), "\n")
congress<-read.csv("congress.csv",header=TRUE)
mydata = congress[congress$year==1986 | congress$year==1988,]
View(mydata)
?congress.csv
data(salmonella)
?salmonella
data(salmonella)
?salmonella
salmonella = read.csv("csalmonella.csv",header=TRUE)
salmonella = data(salmonella)
?salmonella
salmonella = data(salmonella)
?salmonella
view(salmonella)
salmonella = data(salmonella)
?salmonella
View(salmonella)
salmonella = data(salmonella)
?salmonella
head(salmonella)
data(salmonella)
?salmonella
head(salmonella)
View(salmonella)
